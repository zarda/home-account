<h2 mat-dialog-title>{{ title }}</h2>

<mat-dialog-content>
  <div class="form-content">
    <!-- Type Toggle -->
    <div class="type-section">
      <mat-button-toggle-group
        [(ngModel)]="type"
        (change)="onTypeChange()"
        class="type-toggle"
      >
        <mat-button-toggle value="expense">
          <mat-icon>trending_down</mat-icon>
          {{ 'common.expense' | translate }}
        </mat-button-toggle>
        <mat-button-toggle value="income">
          <mat-icon>trending_up</mat-icon>
          {{ 'common.income' | translate }}
        </mat-button-toggle>
      </mat-button-toggle-group>
    </div>

    <!-- Name -->
    <mat-form-field appearance="outline">
      <mat-label>{{ 'settings.name' | translate }}</mat-label>
      <input matInput [(ngModel)]="name" [placeholder]="'settings.namePlaceholder' | translate" />
      <mat-icon matPrefix>label</mat-icon>
    </mat-form-field>

    <!-- Amount and Currency -->
    <div class="amount-row">
      <mat-form-field appearance="outline" class="amount-field">
        <mat-label>{{ 'transactions.amount' | translate }}</mat-label>
        <input matInput type="number" [(ngModel)]="amount" min="0" step="0.01" />
        <mat-icon matPrefix>attach_money</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline" class="currency-field">
        <mat-label>{{ 'settings.currency' | translate }}</mat-label>
        <mat-select [(ngModel)]="currency">
          @for (curr of currencies(); track curr.code) {
            <mat-option [value]="curr.code">
              {{ curr.symbol }} {{ curr.code }}
            </mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Category -->
    <mat-form-field appearance="outline">
      <mat-label>{{ 'transactions.category' | translate }}</mat-label>
      <mat-select [(ngModel)]="categoryId">
        @for (category of filteredCategories(); track category.id) {
          <mat-option [value]="category.id">
            <mat-icon [style.color]="category.color">{{ category.icon }}</mat-icon>
            {{ category.name | translate }}
          </mat-option>
        }
      </mat-select>
      <mat-icon matPrefix>category</mat-icon>
    </mat-form-field>

    <!-- Description -->
    <mat-form-field appearance="outline">
      <mat-label>{{ 'transactions.description' | translate }} ({{ 'settings.optional' | translate }})</mat-label>
      <input matInput [(ngModel)]="description" [placeholder]="'transactions.descriptionPlaceholder' | translate" />
      <mat-icon matPrefix>notes</mat-icon>
    </mat-form-field>

    <!-- Frequency Section -->
    <div class="section-divider">
      <span class="section-label">{{ 'settings.frequency' | translate }}</span>
    </div>

    <div class="frequency-row">
      <mat-form-field appearance="outline" class="interval-field">
        <mat-label>{{ 'settings.every' | translate }}</mat-label>
        <input matInput type="number" [(ngModel)]="interval" min="1" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="frequency-type-field">
        <mat-label>{{ 'settings.period' | translate }}</mat-label>
        <mat-select [(ngModel)]="frequencyType" (selectionChange)="onFrequencyTypeChange()">
          @for (freq of frequencyOptions; track freq.value) {
            <mat-option [value]="freq.value">{{ freq.label }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Day of Week (for weekly) -->
    @if (showDayOfWeek) {
      <mat-form-field appearance="outline">
        <mat-label>{{ 'settings.on' | translate }}</mat-label>
        <mat-select [(ngModel)]="dayOfWeek">
          @for (day of daysOfWeek; track day.value) {
            <mat-option [value]="day.value">{{ day.label }}</mat-option>
          }
        </mat-select>
        <mat-icon matPrefix>today</mat-icon>
      </mat-form-field>
    }

    <!-- Day of Month (for monthly/yearly) -->
    @if (showDayOfMonth) {
      <mat-form-field appearance="outline">
        <mat-label>{{ 'settings.onDay' | translate }}</mat-label>
        <mat-select [(ngModel)]="dayOfMonth">
          @for (day of daysOfMonth; track day) {
            <mat-option [value]="day">{{ day }}</mat-option>
          }
        </mat-select>
        <mat-icon matPrefix>event</mat-icon>
      </mat-form-field>
    }

    <!-- Frequency Preview -->
    <div class="frequency-preview">
      <mat-icon>repeat</mat-icon>
      <span>{{ frequencyPreview }}</span>
    </div>

    <!-- Date Section -->
    <div class="section-divider">
      <span class="section-label">{{ 'settings.duration' | translate }}</span>
    </div>

    <!-- Start Date -->
    <mat-form-field appearance="outline">
      <mat-label>{{ 'settings.startDate' | translate }}</mat-label>
      <input matInput [matDatepicker]="startPicker" [(ngModel)]="startDate" />
      <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
      <mat-datepicker #startPicker></mat-datepicker>
      <mat-icon matPrefix>calendar_today</mat-icon>
    </mat-form-field>

    <!-- End Date Toggle -->
    <div class="end-date-toggle">
      <button mat-button (click)="toggleEndDate()" type="button">
        <mat-icon>{{ hasEndDate ? 'event_busy' : 'event_available' }}</mat-icon>
        {{ hasEndDate ? ('settings.removeEndDate' | translate) : ('settings.addEndDate' | translate) }}
      </button>
    </div>

    <!-- End Date -->
    @if (hasEndDate) {
      <mat-form-field appearance="outline">
        <mat-label>{{ 'settings.endDate' | translate }}</mat-label>
        <input matInput [matDatepicker]="endPicker" [(ngModel)]="endDate" [min]="startDate" />
        <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
        <mat-datepicker #endPicker></mat-datepicker>
        <mat-icon matPrefix>event_busy</mat-icon>
      </mat-form-field>
    }
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="cancel()">{{ 'common.cancel' | translate }}</button>
  <button mat-flat-button color="primary" (click)="save()" [disabled]="!isValid">
    {{ isEdit ? ('settings.saveChanges' | translate) : ('settings.create' | translate) }}
  </button>
</mat-dialog-actions>
