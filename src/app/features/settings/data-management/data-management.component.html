<div class="data-management">
  <!-- Export Section -->
  <div class="section">
    <div class="section-header">
      <mat-icon class="section-icon">download</mat-icon>
      <div>
        <h3>{{ 'settings.exportData' | translate }}</h3>
        <p class="section-description">{{ 'settings.exportDataDescription' | translate }}</p>
      </div>
    </div>

    <div class="export-options">
      <button
        mat-stroked-button
        class="export-btn"
        (click)="exportFullBackup()"
        [disabled]="isExporting()"
      >
        <mat-icon>backup</mat-icon>
        <div class="btn-content">
          <span class="btn-title">{{ 'settings.fullBackup' | translate }}</span>
          <span class="btn-subtitle">{{ 'settings.fullBackupDescription' | translate }}</span>
        </div>
      </button>

      <button
        mat-stroked-button
        class="export-btn"
        (click)="exportTransactionsCSV()"
        [disabled]="isExporting()"
      >
        <mat-icon>table_chart</mat-icon>
        <div class="btn-content">
          <span class="btn-title">{{ 'settings.transactionsCsv' | translate }}</span>
          <span class="btn-subtitle">{{ 'settings.transactionsCsvDescription' | translate }}</span>
        </div>
      </button>
    </div>
  </div>

  <!-- Smart Import Section -->
  <div class="section smart-import-section">
    <div class="section-header">
      <mat-icon class="section-icon ai-icon">auto_awesome</mat-icon>
      <div>
        <h3>{{ 'import.smartImport' | translate }}</h3>
        <p class="section-description">{{ 'import.smartImportDescription' | translate }}</p>
      </div>
    </div>

    <div class="smart-import-features">
      <div class="feature-item">
        <mat-icon>image</mat-icon>
        <span>{{ 'import.featureReceipts' | translate }}</span>
      </div>
      <div class="feature-item">
        <mat-icon>picture_as_pdf</mat-icon>
        <span>{{ 'import.featureBankStatements' | translate }}</span>
      </div>
      <div class="feature-item">
        <mat-icon>category</mat-icon>
        <span>{{ 'import.featureAutoCategory' | translate }}</span>
      </div>
      <div class="feature-item">
        <mat-icon>content_copy</mat-icon>
        <span>{{ 'import.featureDuplicateDetection' | translate }}</span>
      </div>
    </div>

    <div class="smart-import-actions">
      <button mat-flat-button color="primary" routerLink="/import/file">
        <mat-icon>upload</mat-icon>
        {{ 'import.startSmartImport' | translate }}
      </button>
      <button mat-stroked-button routerLink="/import/history">
        <mat-icon>history</mat-icon>
        {{ 'import.viewHistory' | translate }}
      </button>
    </div>
  </div>

  <!-- Simple Import Section -->
  <div class="section">
    <div class="section-header">
      <mat-icon class="section-icon">upload</mat-icon>
      <div>
        <h3>{{ 'settings.importData' | translate }}</h3>
        <p class="section-description">{{ 'settings.importDataDescription' | translate }}</p>
      </div>
    </div>

    @if (!showImportPreview()) {
      <div class="import-dropzone" role="button" tabindex="0" (click)="fileInput.click()" (keydown.enter)="fileInput.click()" (keydown.space)="fileInput.click()">
        <input
          #fileInput
          type="file"
          accept=".csv,.json"
          (change)="onFileSelected($event)"
          hidden
        />
        @if (isImporting()) {
          <mat-spinner diameter="32"></mat-spinner>
          <span>{{ 'settings.processingFile' | translate }}</span>
        } @else {
          <mat-icon>cloud_upload</mat-icon>
          <span class="dropzone-text">{{ 'settings.uploadPrompt' | translate }}</span>
          <span class="dropzone-hint">{{ 'settings.uploadHint' | translate }}</span>
        }
      </div>
    } @else {
      <!-- Import Preview -->
      <div class="import-preview">
        <div class="preview-header">
          <mat-icon>preview</mat-icon>
          <span>{{ 'settings.previewTransactions' | translate:{ count: importedTransactions().length } }}</span>
        </div>

        <div class="preview-list">
          @for (transaction of importedTransactions().slice(0, 5); track $index) {
            <div class="preview-item">
              <span class="preview-date">{{ transaction.date | date:'MMM d, yyyy' }}</span>
              <span class="preview-desc">{{ transaction.description }}</span>
              <span class="preview-amount" [class.income]="transaction.type === 'income'" [class.expense]="transaction.type === 'expense'">
                {{ transaction.type === 'expense' ? '-' : '+' }}{{ transaction.amount | currency:'USD':'symbol':'1.2-2' }}
              </span>
            </div>
          }
          @if (importedTransactions().length > 5) {
            <div class="preview-more">
              {{ 'settings.moreTransactions' | translate:{ count: importedTransactions().length - 5 } }}
            </div>
          }
        </div>

        @if (importProgress() > 0 && importProgress() < 100) {
          <mat-progress-bar mode="determinate" [value]="importProgress()"></mat-progress-bar>
          <span class="progress-text">{{ 'settings.importingProgress' | translate:{ progress: importProgress() } }}</span>
        }

        <div class="preview-actions">
          <button mat-button (click)="cancelImport()">{{ 'common.cancel' | translate }}</button>
          <button
            mat-flat-button
            color="primary"
            (click)="confirmImport()"
            [disabled]="isImporting()"
          >
            {{ 'settings.importTransactions' | translate:{ count: importedTransactions().length } }}
          </button>
        </div>
      </div>
    }
  </div>

  <!-- Danger Zone -->
  <div class="section danger-zone">
    <div class="section-header">
      <mat-icon class="section-icon danger">warning</mat-icon>
      <div>
        <h3>{{ 'settings.dangerZone' | translate }}</h3>
        <p class="section-description">{{ 'settings.irreversibleActions' | translate }}</p>
      </div>
    </div>

    <div class="danger-actions">
      <div class="danger-item">
        <div class="danger-info">
          <span class="danger-title">{{ 'settings.deleteAllTransactions' | translate }}</span>
          <span class="danger-desc">{{ 'settings.deleteAllDescription' | translate }}</span>
        </div>
        <button mat-stroked-button color="warn" (click)="deleteAllTransactions()">
          {{ 'settings.deleteAll' | translate }}
        </button>
      </div>

      <div class="danger-item">
        <div class="danger-info">
          <span class="danger-title">{{ 'auth.signOut' | translate }}</span>
          <span class="danger-desc">{{ 'settings.signOutDescription' | translate }}</span>
        </div>
        <button mat-stroked-button (click)="signOut()">
          {{ 'auth.signOut' | translate }}
        </button>
      </div>
    </div>
  </div>
</div>
