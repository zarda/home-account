<div class="profile-settings">
  <div class="settings-grid">
    <!-- Base Currency -->
    <div class="setting-item">
      <mat-form-field appearance="outline">
        <mat-label>{{ 'settings.currency' | translate }}</mat-label>
        <mat-select [(ngModel)]="baseCurrency" (selectionChange)="onCurrencyChange()">
          @for (currency of currencies; track currency.code) {
            <mat-option [value]="currency.code">
              {{ currency.symbol }} {{ currency.nameKey | translate }} ({{ currency.code }})
            </mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Date Format -->
    <div class="setting-item">
      <mat-form-field appearance="outline">
        <mat-label>{{ 'settings.dateFormat' | translate }}</mat-label>
        <mat-select [(ngModel)]="dateFormat" (selectionChange)="onDateFormatChange()">
          @for (format of dateFormats; track format.value) {
            <mat-option [value]="format.value">{{ format.label }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Language -->
    <div class="setting-item">
      <mat-form-field appearance="outline">
        <mat-label>{{ 'settings.language' | translate }}</mat-label>
        <mat-select [(ngModel)]="language" (selectionChange)="onLanguageChange()">
          @for (lang of languages; track lang.code) {
            <mat-option [value]="lang.code">{{ lang.nativeName }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>
  </div>

  <!-- Theme Selection -->
  <div class="theme-section">
    <span class="section-label" id="theme-label">{{ 'settings.theme' | translate }}</span>
    <mat-button-toggle-group [(ngModel)]="theme" (change)="onThemeChange()" class="theme-toggle" aria-labelledby="theme-label">
      <mat-button-toggle value="light">
        <mat-icon>light_mode</mat-icon>
        <span>{{ 'settings.themeLight' | translate }}</span>
      </mat-button-toggle>
      <mat-button-toggle value="dark">
        <mat-icon>dark_mode</mat-icon>
        <span>{{ 'settings.themeDark' | translate }}</span>
      </mat-button-toggle>
      <mat-button-toggle value="system">
        <mat-icon>settings_brightness</mat-icon>
        <span>{{ 'settings.themeSystem' | translate }}</span>
      </mat-button-toggle>
    </mat-button-toggle-group>
  </div>

  <!-- Gemini API Key -->
  <div class="api-key-section">
    <span class="section-label">{{ 'settings.geminiApiKey' | translate }}</span>
    <p class="section-hint">{{ 'settings.geminiApiKeyHint' | translate }}</p>

    <mat-form-field appearance="outline" class="api-key-field">
      <mat-label>{{ 'settings.apiKey' | translate }}</mat-label>
      <input matInput
             type="password"
             [(ngModel)]="geminiApiKey"
             (blur)="onApiKeyChange()"
             placeholder="AIza...">
      @if (geminiApiKey) {
        <button mat-icon-button matSuffix (click)="clearApiKey()" type="button">
          <mat-icon>close</mat-icon>
        </button>
      }
    </mat-form-field>

    <div class="api-key-actions">
      <button mat-stroked-button
              [disabled]="!geminiApiKey || isTestingKey"
              (click)="testApiKey()"
              type="button">
        @if (isTestingKey) {
          <mat-spinner diameter="18"></mat-spinner>
        } @else {
          {{ 'settings.testApiKey' | translate }}
        }
      </button>

      @if (keyTestResult === 'success') {
        <span class="test-result success">
          <mat-icon>check_circle</mat-icon>
          {{ 'settings.apiKeyValid' | translate }}
        </span>
      }
      @if (keyTestResult === 'error') {
        <span class="test-result error">
          <mat-icon>error</mat-icon>
          {{ 'settings.apiKeyInvalid' | translate }}
        </span>
      }
    </div>

    <a mat-button
       href="https://aistudio.google.com/app/apikey"
       target="_blank"
       rel="noopener">
      <mat-icon>open_in_new</mat-icon>
      {{ 'settings.getApiKey' | translate }}
    </a>
  </div>
</div>
