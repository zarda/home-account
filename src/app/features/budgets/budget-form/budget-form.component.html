<div class="budget-form-dialog">
  <!-- Header -->
  <div class="flex items-center justify-between px-6 py-4 border-b">
    <h2 class="text-xl font-semibold">
      {{ data.mode === 'add' ? 'Create Budget' : 'Edit Budget' }}
    </h2>
    <button mat-icon-button (click)="onCancel()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <mat-dialog-content class="!px-6 !py-4">
      <!-- Budget name -->
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Budget Name</mat-label>
        <input matInput formControlName="name" placeholder="e.g., Monthly Groceries">
        @if (form.get('name')?.hasError('required') && form.get('name')?.touched) {
          <mat-error>Name is required</mat-error>
        }
      </mat-form-field>

      <!-- Category selection -->
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Category</mat-label>
        <mat-select formControlName="categoryId">
          @for (category of expenseCategories(); track category.id) {
            <mat-option [value]="category.id">
              <div class="flex items-center gap-2">
                <mat-icon [style.color]="category.color" class="!text-lg">
                  {{ category.icon }}
                </mat-icon>
                <span>{{ category.name }}</span>
              </div>
            </mat-option>
          }
        </mat-select>
        @if (form.get('categoryId')?.hasError('required') && form.get('categoryId')?.touched) {
          <mat-error>Category is required</mat-error>
        }
      </mat-form-field>

      <!-- Amount and Currency -->
      <div class="flex gap-4">
        <mat-form-field appearance="outline" class="flex-1">
          <mat-label>Budget Amount</mat-label>
          <input matInput type="number" formControlName="amount" step="0.01" min="0.01">
          @if (form.get('amount')?.hasError('required') && form.get('amount')?.touched) {
            <mat-error>Amount is required</mat-error>
          }
          @if (form.get('amount')?.hasError('min')) {
            <mat-error>Amount must be greater than 0</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-28">
          <mat-label>Currency</mat-label>
          <mat-select formControlName="currency">
            @for (currency of currencies; track currency.code) {
              <mat-option [value]="currency.code">
                {{ currency.code }}
              </mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>

      <!-- Period selection -->
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Budget Period</mat-label>
        <mat-select formControlName="period">
          @for (period of periods; track period.value) {
            <mat-option [value]="period.value">{{ period.label }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <!-- Alert threshold slider -->
      <div class="threshold-section mt-4 mb-2">
        <span class="block text-xs text-gray-500 mb-3 text-center" id="threshold-label">Alert when spending reaches: <strong class="text-sm text-gray-700">{{ form.value.alertThreshold }}%</strong></span>
        <div class="slider-container">
          <mat-slider min="50" max="100" step="5" aria-labelledby="threshold-label" discrete>
            <input matSliderThumb formControlName="alertThreshold">
          </mat-slider>
          <div class="flex justify-between text-xs text-gray-400 mt-1">
            <span>50%</span>
            <span>100%</span>
          </div>
        </div>
      </div>
    </mat-dialog-content>

    <mat-dialog-actions class="!px-6 !py-4 border-t">
      <button mat-stroked-button type="button" (click)="onCancel()">
        Cancel
      </button>
      <button mat-flat-button color="primary" type="submit"
              [disabled]="form.invalid || isSubmitting()">
        @if (isSubmitting()) {
          <mat-spinner diameter="20" class="inline-block mr-2"></mat-spinner>
        }
        {{ data.mode === 'add' ? 'Create Budget' : 'Save Changes' }}
      </button>
    </mat-dialog-actions>
  </form>
</div>
