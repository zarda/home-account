@if (transactions.length === 0) {
  <app-empty-state
    icon="receipt_long"
    title="No transactions found"
    description="Try adjusting your filters or add a new transaction"
  />
} @else {
  <!-- Mobile View -->
  <div class="mobile-view">
    <div class="mobile-list">
      @for (transaction of sortedTransactions; track transaction.id; let last = $last) {
        <div
          class="mobile-item"
          role="button"
          tabindex="0"
          (click)="edit.emit(transaction)"
          (keydown.enter)="edit.emit(transaction)">
          <!-- Category Icon -->
          <div
            class="category-icon"
            [style.background-color]="getCategoryColor(transaction.categoryId) + '15'"
          >
            <mat-icon [style.color]="getCategoryColor(transaction.categoryId)">
              {{ getCategoryIcon(transaction.categoryId) }}
            </mat-icon>
          </div>

          <!-- Details -->
          <div class="item-details">
            <span class="item-description">{{ transaction.description }}</span>
            <span class="item-category">{{ getCategoryName(transaction.categoryId) }}</span>
          </div>

          <!-- Amount & Date -->
          <div class="item-amount">
            <span
              class="amount"
              [class.income]="transaction.type === 'income'"
              [class.expense]="transaction.type === 'expense'"
            >
              {{ transaction.type === 'income' ? '+' : '-' }}{{ formatAmount(transaction.amount, transaction.currency) }}
            </span>
            <span class="item-date">{{ formatRelativeDate(transaction.date) }}</span>
          </div>

          <!-- Mobile Actions -->
          <button
            mat-icon-button
            class="mobile-menu-btn"
            [matMenuTriggerFor]="mobileMenu"
            (click)="$event.stopPropagation()"
          >
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #mobileMenu="matMenu">
            <button mat-menu-item (click)="edit.emit(transaction)">
              <mat-icon>edit</mat-icon>
              <span>Edit</span>
            </button>
            <button mat-menu-item (click)="confirmDelete(transaction)">
              <mat-icon class="text-red-500">delete</mat-icon>
              <span class="text-red-500">Delete</span>
            </button>
          </mat-menu>
        </div>
        @if (!last) {
          <div class="mobile-divider"></div>
        }
      }
    </div>
  </div>

  <!-- Desktop Table View -->
  <div class="desktop-view">
    <table mat-table [dataSource]="sortedTransactions" matSort (matSortChange)="onSortChange($event)" class="desktop-table">
      <!-- Date Column -->
      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="col-date">Date</th>
        <td mat-cell *matCellDef="let transaction" class="col-date">
          <span class="date-text">{{ formatRelativeDate(transaction.date) }}</span>
        </td>
      </ng-container>

      <!-- Category Column -->
      <ng-container matColumnDef="category">
        <th mat-header-cell *matHeaderCellDef class="col-category">Category</th>
        <td mat-cell *matCellDef="let transaction" class="col-category">
          <div class="category-cell">
            <div
              class="category-icon-sm"
              [style.background-color]="getCategoryColor(transaction.categoryId) + '15'"
            >
              <mat-icon [style.color]="getCategoryColor(transaction.categoryId)">
                {{ getCategoryIcon(transaction.categoryId) }}
              </mat-icon>
            </div>
            <span class="category-name">{{ getCategoryName(transaction.categoryId) }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Description Column -->
      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="col-description">Description</th>
        <td mat-cell *matCellDef="let transaction" class="col-description">
          <span class="description-text">{{ transaction.description }}</span>
          @if (transaction.note) {
            <mat-icon class="note-icon" [matTooltip]="transaction.note">notes</mat-icon>
          }
        </td>
      </ng-container>

      <!-- Amount Column -->
      <ng-container matColumnDef="amount">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="col-amount">Amount</th>
        <td mat-cell *matCellDef="let transaction" class="col-amount">
          <span
            class="amount-text"
            [class.income]="transaction.type === 'income'"
            [class.expense]="transaction.type === 'expense'"
          >
            {{ transaction.type === 'income' ? '+' : '-' }}{{ formatAmount(transaction.amount, transaction.currency) }}
          </span>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="col-actions"></th>
        <td mat-cell *matCellDef="let transaction" class="col-actions">
          <button mat-icon-button class="action-btn" [matMenuTriggerFor]="menu" (click)="$event.stopPropagation()">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="edit.emit(transaction)">
              <mat-icon>edit</mat-icon>
              <span>Edit</span>
            </button>
            <button mat-menu-item (click)="confirmDelete(transaction)">
              <mat-icon class="text-red-500">delete</mat-icon>
              <span class="text-red-500">Delete</span>
            </button>
          </mat-menu>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns"
        class="table-row"
        (click)="edit.emit(row)"
      ></tr>
    </table>
  </div>
}
