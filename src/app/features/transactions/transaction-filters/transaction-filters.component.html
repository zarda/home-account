<div class="filters-container">
  <!-- Toolbar Row -->
  <div class="toolbar">
    <!-- Quick Filters -->
    <div class="quick-filters">
      <button
        class="quick-btn"
        [class.active]="isQuickFilterActive('today')"
        (click)="setQuickFilter('today')"
      >{{ 'transactions.today' | translate }}</button>
      <button
        class="quick-btn"
        [class.active]="isQuickFilterActive('thisWeek')"
        (click)="setQuickFilter('thisWeek')"
      >{{ 'transactions.week' | translate }}</button>
      <button
        class="quick-btn"
        [class.active]="isQuickFilterActive('thisMonth')"
        (click)="setQuickFilter('thisMonth')"
      >{{ 'transactions.month' | translate }}</button>
      <button class="quick-btn date-picker-btn" (click)="dayPicker.open()">
        <mat-icon>calendar_today</mat-icon>
      </button>
      <input
        [matDatepicker]="dayPicker"
        (dateChange)="setDateFilter($event.value)"
        style="display: none"
      >
      <mat-datepicker
        #dayPicker
        [dateClass]="dateClass"
        (monthSelected)="onCalendarMonthChange($event)"
        (yearSelected)="onCalendarYearChange($event)"
      ></mat-datepicker>

      <!-- Period Picker Menu -->
      <button class="quick-btn date-picker-btn" [matMenuTriggerFor]="periodMenu">
        <mat-icon>calendar_month</mat-icon>
      </button>
      <mat-menu #periodMenu="matMenu">
        <button mat-menu-item (click)="openMonthPicker()">
          <mat-icon>event</mat-icon>
          <span>{{ 'dashboard.selectMonth' | translate }}</span>
        </button>
        <button mat-menu-item (click)="openYearPicker()">
          <mat-icon>date_range</mat-icon>
          <span>{{ 'dashboard.selectYear' | translate }}</span>
        </button>
      </mat-menu>

      <!-- Hidden Month Picker -->
      <input [matDatepicker]="monthPicker" style="display: none">
      <mat-datepicker
        #monthPicker
        startView="year"
        (monthSelected)="onMonthSelected($event, monthPicker)"
      ></mat-datepicker>

      <!-- Hidden Year Picker -->
      <input [matDatepicker]="yearPicker" style="display: none">
      <mat-datepicker
        #yearPicker
        startView="multi-year"
        (yearSelected)="onYearSelected($event, yearPicker)"
      ></mat-datepicker>
    </div>

    <!-- Filter Toggle -->
    <button
      class="filter-toggle"
      [class.has-filters]="activeFilterCount() > 0"
      (click)="expanded.set(!expanded())"
    >
      <mat-icon>tune</mat-icon>
      @if (activeFilterCount() > 0) {
        <span class="filter-badge">{{ activeFilterCount() }}</span>
      }
    </button>

    <!-- Add Button -->
    <button class="add-btn" (click)="addTransaction.emit()">
      <mat-icon>add</mat-icon>
      <span class="add-label">{{ 'common.add' | translate }}</span>
    </button>
  </div>

  <!-- Expandable Filters -->
  @if (expanded()) {
    <div class="filter-panel">
      <!-- Search -->
      <div class="search-wrapper">
        <mat-icon class="search-icon">search</mat-icon>
        <input
          type="text"
          class="search-input"
          [placeholder]="'transactions.searchPlaceholder' | translate"
          [(ngModel)]="filters.searchQuery"
          (input)="onFilterChange()"
        >
      </div>

      <div class="filter-grid">
        <!-- Type -->
        <mat-form-field appearance="outline" class="compact-field">
          <mat-label>{{ 'transactions.type' | translate }}</mat-label>
          <mat-select [(ngModel)]="filters.type" (selectionChange)="onFilterChange()">
            <mat-option [value]="undefined">{{ 'transactions.all' | translate }}</mat-option>
            <mat-option value="income">{{ 'common.income' | translate }}</mat-option>
            <mat-option value="expense">{{ 'common.expense' | translate }}</mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Category -->
        <mat-form-field appearance="outline" class="compact-field">
          <mat-label>{{ 'transactions.category' | translate }}</mat-label>
          <mat-select [(ngModel)]="filters.categoryId" (selectionChange)="onFilterChange()">
            <mat-option [value]="undefined">{{ 'transactions.all' | translate }}</mat-option>
            <mat-optgroup [label]="'common.expense' | translate">
              @for (cat of categories; track cat.id) {
                <mat-option [value]="cat.id">{{ cat.name | translate }}</mat-option>
              }
            </mat-optgroup>
            <mat-optgroup [label]="'common.income' | translate">
              @for (cat of incomeCategories; track cat.id) {
                <mat-option [value]="cat.id">{{ cat.name | translate }}</mat-option>
              }
            </mat-optgroup>
          </mat-select>
        </mat-form-field>

        <!-- Date Range -->
        <mat-form-field appearance="outline" class="compact-field">
          <mat-label>{{ 'transactions.from' | translate }}</mat-label>
          <input matInput [matDatepicker]="startPicker" [(ngModel)]="filters.startDate" (dateChange)="onFilterChange()">
          <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
          <mat-datepicker
            #startPicker
            [dateClass]="dateClass"
            (monthSelected)="onCalendarMonthChange($event)"
            (yearSelected)="onCalendarYearChange($event)"
          ></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline" class="compact-field">
          <mat-label>{{ 'transactions.to' | translate }}</mat-label>
          <input matInput [matDatepicker]="endPicker" [(ngModel)]="filters.endDate" (dateChange)="onFilterChange()">
          <mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle>
          <mat-datepicker
            #endPicker
            [dateClass]="dateClass"
            (monthSelected)="onCalendarMonthChange($event)"
            (yearSelected)="onCalendarYearChange($event)"
          ></mat-datepicker>
        </mat-form-field>

        <!-- Amount Range -->
        <mat-form-field appearance="outline" class="compact-field">
          <mat-label>{{ 'transactions.minAmount' | translate }}</mat-label>
          <input matInput type="number" [(ngModel)]="filters.minAmount" (input)="onFilterChange()">
        </mat-form-field>

        <mat-form-field appearance="outline" class="compact-field">
          <mat-label>{{ 'transactions.maxAmount' | translate }}</mat-label>
          <input matInput type="number" [(ngModel)]="filters.maxAmount" (input)="onFilterChange()">
        </mat-form-field>
      </div>

      @if (activeFilterCount() > 0) {
        <button class="clear-btn" (click)="clearFilters()">
          <mat-icon>clear</mat-icon>
          {{ 'transactions.clearAll' | translate }}
        </button>
      }
    </div>
  }
</div>
